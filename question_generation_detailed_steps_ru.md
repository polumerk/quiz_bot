# üîß –î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ Quiz Bot 2.0

## üìã –û–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞

–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ Quiz Bot 2.0 - —ç—Ç–æ —Å–ª–æ–∂–Ω—ã–π –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –≤–∫–ª—é—á–∞—é—â–∏–π –≤–∞–ª–∏–¥–∞—Ü–∏—é, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ OpenAI, –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–∞—Ä—Å–∏–Ω–≥ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

## üöÄ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        QUESTION GENERATION PIPELINE                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ  [1] –ò–ù–ò–¶–ò–ê–¶–ò–Ø      [2] –í–ê–õ–ò–î–ê–¶–ò–Ø     [3] –ò–°–¢–û–†–ò–Ø        [4] –ü–†–û–ú–ü–¢         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ start_round ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –ù–∞—Å—Ç—Ä–æ–π–∫–∏   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –ü–æ–ª—É—á–µ–Ω–∏–µ   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ             ‚îÇ    ‚îÇ –∏–≥—Ä—ã        ‚îÇ    ‚îÇ –∏—Å—Ç–æ—Ä–∏–∏     ‚îÇ    ‚îÇ –∑–∞–ø—Ä–æ—Å–∞     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  [5] –ó–ê–ü–†–û–°         [6] –û–ë–†–ê–ë–û–¢–ö–ê     [7] –í–ê–õ–ò–î–ê–¶–ò–Ø     [8] –°–û–•–†–ê–ù–ï–ù–ò–ï     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ OpenAI API  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –ü–∞—Ä—Å–∏–Ω–≥     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –ü—Ä–æ–≤–µ—Ä–∫–∞    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –í –∏–≥—Ä–æ–≤–æ–µ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ             ‚îÇ    ‚îÇ JSON        ‚îÇ    ‚îÇ –∫–∞—á–µ—Å—Ç–≤–∞    ‚îÇ    ‚îÇ —Å–æ—Å—Ç–æ—è–Ω–∏–µ   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  [9] –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï   [10] –ì–û–¢–û–í–ù–û–°–¢–¨   [11] –ó–ê–ü–£–°–ö       [12] –û–ë–†–ê–ë–û–¢–ö–ê     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ –ü—Ä–æ–≤–µ—Ä–∫–∞    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –ü—Ä–æ–≤–µ—Ä–∫–∞    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –ü–æ–∫–∞–∑       ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ –û—à–∏–±–∫–∏ –∏    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ –¥—É–±–ª–µ–π      ‚îÇ    ‚îÇ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏  ‚îÇ    ‚îÇ –≤–æ–ø—Ä–æ—Å–æ–≤    ‚îÇ    ‚îÇ —Ñ–æ–ª–±—ç–∫–∏     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

### **–®–ê–ì 1: –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞**

**–§–∞–π–ª:** `src/game/logic.py` ‚Üí `start_round()`

```python
async def start_round(context: ContextTypes.DEFAULT_TYPE, chat_id: ChatID) -> None:
    """Start a new round of the game"""
    game_state = get_game_state(chat_id)
    
    # 1.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
    if not game_state.settings:
        await context.bot.send_message(
            chat_id, 
            "‚ùå –û—à–∏–±–∫–∞: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã –Ω–µ –∑–∞–¥–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."
        )
        return
    
    settings = game_state.settings
    
    # 1.2 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    await context.bot.send_message(chat_id, "üß† –ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–æ–ø—Ä–æ—Å—ã...")
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫:**
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∏–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ?
- ‚úÖ –ï—Å—Ç—å –ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã?
- ‚úÖ –í—Å–µ –ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã?

### **–®–ê–ì 2: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫**

**–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```python
# 2.1 –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
theme = settings.theme              # "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏"
difficulty = settings.difficulty    # Difficulty.MEDIUM
rounds = settings.rounds            # 2
questions_per_round = settings.questions_per_round  # 5
time_per_question = settings.time_per_question      # 300
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏:**
```python
# 2.2 –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–µ—è–≤–Ω—ã–µ)
if not theme or len(theme) < 2:
    # –û—à–∏–±–∫–∞: —Ç–µ–º–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è
    
if questions_per_round < 1 or questions_per_round > 20:
    # –û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
    
if difficulty not in [Difficulty.EASY, Difficulty.MEDIUM, Difficulty.HARD]:
    # –û—à–∏–±–∫–∞: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
```

### **–®–ê–ì 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤**

**–§–∞–π–ª:** `questions.py` ‚Üí `openai_generate_questions()`

```python
# 3.1 –ó–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
history_questions = get_questions_history(theme, limit=50)

# 3.2 –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
history_text = ''
if history_questions:
    history_text = ('\n–í–æ—Ç –ø—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ —Ä–∞–Ω–µ–µ, '
                   '–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –∏—Ö:\n' + 
                   '\n'.join(f'- {q}' for q in history_questions))
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π:**
- üìä –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ–º–µ
- üîç –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- üìù –í–∫–ª—é—á–∞–µ–º –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è OpenAI

**–ü—Ä–∏–º–µ—Ä history_text:**
```
–í–æ—Ç –ø—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ —Ä–∞–Ω–µ–µ, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –∏—Ö:
- –í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª–∞ –ö—É–ª–∏–∫–æ–≤—Å–∫–∞—è –±–∏—Ç–≤–∞?
- –ö—Ç–æ –±—ã–ª –ø–µ—Ä–≤—ã–º —Ü–∞—Ä–µ–º –∏–∑ –¥–∏–Ω–∞—Å—Ç–∏–∏ –†–æ–º–∞–Ω–æ–≤—ã—Ö?
- –í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –ú–æ—Å–∫–≤–∞?
```

### **–®–ê–ì 4: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞**

**–§–∞–π–ª:** `questions.py` ‚Üí `build_openai_prompt()`

```python
def build_openai_prompt(theme: str, round_num: int, questions_per_round: int, 
                       history_text: str, difficulty: str = 'medium') -> str:
    
    # 4.1 –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è —Å–ø–æ—Ä—Ç–∞
    sport_examples = ""
    if "—Å–ø–æ—Ä—Ç" in theme.lower():
        sport_examples = """
–ü–†–ò–ú–ï–†–´ –•–û–†–û–®–ò–• —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —Ç–æ—á–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏:
- "–°–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ñ—É—Ç–±–æ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ –Ω–∞ –ø–æ–ª–µ?" ‚Üí "11"
- "–í –∫–∞–∫–æ–º –≥–æ–¥—É –≤–ø–µ—Ä–≤—ã–µ –ø—Ä–æ—à–ª–∏ –û–ª–∏–º–ø–∏–π—Å–∫–∏–µ –∏–≥—Ä—ã?" ‚Üí "1896"
- "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ –¥–ª—è –∏–≥—Ä—ã –≤ —Ç–µ–Ω–Ω–∏—Å?" ‚Üí "–ö–æ—Ä—Ç"
"""
    
    # 4.2 –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
    return (
        START_PROMPT +
        f"\n–¢–µ–º–∞: {theme}"
        f"\n–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π {questions_per_round} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö, —Ç–æ—á–Ω—ã—Ö –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã—Ö "
        f"–≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ä–∞—É–Ω–¥–∞ {round_num}. "
        f"–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: {difficulty}. "
        "–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, "
        "–∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ª—å–∑—è —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å –ø–æ-—Ä–∞–∑–Ω–æ–º—É. "
        "–ò–∑–±–µ–≥–∞–π –≤–æ–ø—Ä–æ—Å–æ–≤, –≥–¥–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞. "
        "–§–æ—Ä–º—É–ª–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å—ã –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏ –Ω–µ–¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ. "
        + sport_examples +
        "\n\n–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON-–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–ª—è–º–∏: "
        "question, answer, difficulty (easy/medium/hard). "
        "–í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ JSON-–º–∞—Å—Å–∏–≤, –±–µ–∑ –æ–±—ë—Ä—Ç–∫–∏ –∏ –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞. "
        f"{history_text}"
    )
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–º–ø—Ç–∞:**
- üéØ **–°–∏—Å—Ç–µ–º–Ω–∞—è —Ä–æ–ª—å**: "–¢—ã AI-–≤–µ–¥—É—â–∏–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∫–≤–∏–∑–∞"
- üìö **–¢–µ–º–∞**: –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
- üéöÔ∏è **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: easy/medium/hard
- üìä **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: –¢–æ—á–Ω–æ–µ —á–∏—Å–ª–æ –≤–æ–ø—Ä–æ—Å–æ–≤
- üö´ **–ò—Å—Ç–æ—Ä–∏—è**: –°–ø–∏—Å–æ–∫ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–µ–π
- üìã **–§–æ—Ä–º–∞—Ç**: –°—Ç—Ä–æ–≥–∏–π JSON —Ñ–æ—Ä–º–∞—Ç
- ‚ö†Ô∏è **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –û–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤

### **–®–ê–ì 5: –ó–∞–ø—Ä–æ—Å –∫ OpenAI API**

```python
# 5.1 –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞
OPENAI_KEY = os.getenv('OPENAI_API_KEY')
if not OPENAI_KEY:
    try:
        with open('openai_key.txt', 'r', encoding='utf-8') as f:
            OPENAI_KEY = f.read().strip()
    except FileNotFoundError:
        # –û—à–∏–±–∫–∞: –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω
        return [{"question": "‚ùå OpenAI API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω", 
                "answer": "N/A", "difficulty": "medium"}]

# 5.2 –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–∞
if not OPENAI_KEY or not OPENAI_KEY.startswith('sk-'):
    return [{"question": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π OpenAI API –∫–ª—é—á", 
            "answer": "N/A", "difficulty": "medium"}]

# 5.3 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
headers = {
    'Authorization': f'Bearer {OPENAI_KEY}',
    'Content-Type': 'application/json',
}

data = {
    "model": "gpt-4o",                    # –ú–æ–¥–µ–ª—å GPT-4 Omni
    "messages": [
        {"role": "system", "content": SYSTEM_PROMPT_QUESTION},
        {"role": "user", "content": prompt}
    ],
    "max_tokens": 1024,                   # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤
    "temperature": 0.2                    # –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
}

# 5.4 –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
async with aiohttp.ClientSession() as session:
    async with session.post('https://api.openai.com/v1/chat/completions', 
                          headers=headers, json=data) as resp:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–≤–µ—Ç–∞
        if resp.status != 200:
            error_text = await resp.text()
            return [{"question": f"–û—à–∏–±–∫–∞ OpenAI API (HTTP {resp.status})", 
                    "answer": "N/A", "difficulty": "medium"}]
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- ü§ñ **–ú–æ–¥–µ–ª—å**: gpt-4o (GPT-4 Omni)
- üéØ **Temperature**: 0.2 (–Ω–∏–∑–∫–∞—è –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
- üìä **Max tokens**: 1024 (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 5-10 –≤–æ–ø—Ä–æ—Å–æ–≤)
- üîß **System prompt**: –†–æ–ª—å AI-–≤–µ–¥—É—â–µ–≥–æ –∫–≤–∏–∑–∞
- üìù **User prompt**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### **–®–ê–ì 6: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ OpenAI**

```python
# 6.1 –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞
try:
    result = await resp.json()
except Exception as e:
    return [{"question": "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ OpenAI", 
            "answer": "N/A", "difficulty": "medium"}]

# 6.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞
if not isinstance(result, dict):
    return [{"question": "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤", 
            "answer": "N/A", "difficulty": "medium"}]

# 6.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ API
if 'error' in result:
    error_msg = result['error'].get('message', 'Unknown error')
    return [{"question": f"–û—à–∏–±–∫–∞ OpenAI: {error_msg}", 
            "answer": "N/A", "difficulty": "medium"}]

# 6.4 –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
if 'choices' not in result or not result['choices']:
    return [{"question": "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤", 
            "answer": "N/A", "difficulty": "medium"}]

# 6.5 –û—á–∏—Å—Ç–∫–∞ –æ—Ç markdown —Ä–∞–∑–º–µ—Ç–∫–∏
text = result['choices'][0]['message']['content']
text = re.sub(r'^```json\s*|```$', '', text.strip(), flags=re.MULTILINE)
text = text.strip()

# 6.6 –ü–∞—Ä—Å–∏–Ω–≥ JSON —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏
try:
    questions = json.loads(text)
except Exception as e:
    return [{"question": "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤–æ–ø—Ä–æ—Å–æ–≤", 
            "answer": "N/A", "difficulty": "medium"}]
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ OpenAI:**
```json
[
  {
    "question": "–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª–∞ –ü–æ–ª—Ç–∞–≤—Å–∫–∞—è –±–∏—Ç–≤–∞?",
    "answer": "1709",
    "difficulty": "medium"
  },
  {
    "question": "–ö—Ç–æ –±—ã–ª –ø–µ—Ä–≤—ã–º –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –†–æ—Å—Å–∏–∏?",
    "answer": "–ü–µ—Ç—Ä I",
    "difficulty": "medium"
  }
]
```

### **–®–ê–ì 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**

```python
# 7.1 –°–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
unique_questions = []
history_set = set(q.strip().lower() for q in history_questions)

# 7.2 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–µ–π
for q in questions:
    q_text = q.get('question', str(q)) if isinstance(q, dict) else str(q)
    if q_text.strip().lower() not in history_set:
        unique_questions.append(q)

# 7.3 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤
attempts = 0
while len(unique_questions) < questions_per_round and attempts < 2:
    missing = questions_per_round - len(unique_questions)
    
    # –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
    extra_prompt = build_openai_prompt(theme, round_num, missing, 
                                     history_text, difficulty)
    
    # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ OpenAI
    # ... (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∫–æ–¥ –∑–∞–ø—Ä–æ—Å–∞)
    
    attempts += 1
```

**–õ–æ–≥–∏–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
- üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
- üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ set –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ
- üõ°Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ (–º–∞–∫—Å–∏–º—É–º 2)

### **–®–ê–ì 8: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤**

**–§–∞–π–ª:** `src/game/logic.py` ‚Üí `start_round()`

```python
# 8.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
if (len(questions_data) == 1 and 
    isinstance(questions_data[0], dict) and 
    "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤" in str(questions_data[0].get('question', ''))):
    
    await context.bot.send_message(
        chat_id, 
        "‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ OpenAI. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n"
        "‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞\n"
        "‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å OpenAI API\n"
        "‚Ä¢ –¢–µ–º—É (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é)\n\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."
    )
    return

# 8.2 –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ Question
question_objects = []
for i, q_data in enumerate(questions_data):
    try:
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        if not isinstance(q_data, dict):
            continue
        
        required_fields = ['question']
        if not all(field in q_data for field in required_fields):
            continue
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ Question
        question = Question.from_dict(q_data)
        question_objects.append(question)
        
    except Exception as e:
        log_error(e, f"parsing question {i}: {q_data}", chat_id)
        continue
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è Question.from_dict():**
```python
@classmethod
def from_dict(cls, data: Dict[str, Any]) -> 'Question':
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
    if not isinstance(data, dict):
        raise ValueError(f"Expected dict, got {type(data)}: {data}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—è
    if 'question' not in data:
        raise ValueError(f"Question data missing 'question' field: {data}")
    
    question = data['question']
    if not question or not isinstance(question, str):
        raise ValueError(f"Question field must be non-empty string: {question}")
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–µ–π
    correct_answer = data.get('answer', data.get('correct_answer', ''))
    if not correct_answer:
        correct_answer = '–ù–µ —É–∫–∞–∑–∞–Ω'
    
    # –ü–∞—Ä—Å–∏–Ω–≥ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    difficulty_str = data.get('difficulty', 'medium')
    try:
        difficulty = Difficulty(difficulty_str)
    except ValueError:
        difficulty = Difficulty.MEDIUM
    
    return cls(
        question=question,
        correct_answer=correct_answer,
        difficulty=difficulty,
        explanation=data.get('explanation', '')
    )
```

### **–®–ê–ì 9: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**

```python
# 9.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è
if not question_objects:
    await context.bot.send_message(
        chat_id, 
        "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ OpenAI.\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API."
    )
    return

# 9.2 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
game_state.questions = question_objects
game_state.question_index = 0

# 9.3 –ó–∞–ø—É—Å–∫ –ø–æ–∫–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
await ask_next_question(context, chat_id)
```

### **–®–ê–ì 10: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é**

```python
# 10.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
for q in unique_questions:
    q_text = q.get('question', str(q)) if isinstance(q, dict) else str(q)
    add_question_to_history(theme, q_text)
```

**–§—É–Ω–∫—Ü–∏—è add_question_to_history():**
```python
def add_question_to_history(theme: str, question: str):
    with sqlite3.connect(DB_PATH) as conn:
        conn.execute('INSERT INTO questions_history (theme, question) VALUES (?, ?)', 
                    (theme, question))
        conn.commit()
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Ñ–æ–ª–±—ç–∫–∏

### **–¢–∏–ø—ã –æ—à–∏–±–æ–∫:**

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ API –∫–ª—é—á–∞**
   ```python
   return [{"question": "‚ùå OpenAI API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω", 
           "answer": "N/A", "difficulty": "medium"}]
   ```

2. **HTTP –æ—à–∏–±–∫–∏**
   ```python
   if resp.status != 200:
       error_text = await resp.text()
       return [{"question": f"–û—à–∏–±–∫–∞ OpenAI API (HTTP {resp.status})", 
               "answer": "N/A", "difficulty": "medium"}]
   ```

3. **–û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON**
   ```python
   except Exception as e:
       return [{"question": "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ OpenAI", 
               "answer": "N/A", "difficulty": "medium"}]
   ```

4. **–û—à–∏–±–∫–∏ OpenAI API**
   ```python
   if 'error' in result:
       error_msg = result['error'].get('message', 'Unknown error')
       return [{"question": f"–û—à–∏–±–∫–∞ OpenAI: {error_msg}", 
               "answer": "N/A", "difficulty": "medium"}]
   ```

### **–§–æ–ª–±—ç–∫–∏:**

1. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤
2. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π
3. **Graceful degradation** - –ø–æ–∫–∞–∑ –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ –∫—Ä–∞—Ö–∞

## üìä –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

### **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```python
theme = "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏"
difficulty = "medium"
questions_per_round = 3
round_num = 1
```

### **–ü—Ä–æ–º–ø—Ç –¥–ª—è OpenAI:**
```
–¢—ã AI-–≤–µ–¥—É—â–∏–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∫–≤–∏–∑–∞.
–¢–µ–º–∞: –ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö, —Ç–æ—á–Ω—ã—Ö –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ä–∞—É–Ω–¥–∞ 1.
–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: medium.
–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç...
```

### **–û—Ç–≤–µ—Ç OpenAI:**
```json
[
  {
    "question": "–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª–∞ –ü–æ–ª—Ç–∞–≤—Å–∫–∞—è –±–∏—Ç–≤–∞?",
    "answer": "1709",
    "difficulty": "medium"
  },
  {
    "question": "–ö—Ç–æ –æ—Å–Ω–æ–≤–∞–ª –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥?",
    "answer": "–ü–µ—Ç—Ä I",
    "difficulty": "medium"
  }
]
```

### **–ò—Ç–æ–≥–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã Question:**
```python
[
  Question(
    question="–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª–∞ –ü–æ–ª—Ç–∞–≤—Å–∫–∞—è –±–∏—Ç–≤–∞?",
    correct_answer="1709",
    difficulty=Difficulty.MEDIUM,
    explanation=""
  ),
  Question(
    question="–ö—Ç–æ –æ—Å–Ω–æ–≤–∞–ª –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥?",
    correct_answer="–ü–µ—Ç—Ä I",
    difficulty=Difficulty.MEDIUM,
    explanation=""
  )
]
```

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

```python
def generate_questions_logic(theme, difficulty, count, round_num):
    """–ü—Å–µ–≤–¥–æ–∫–æ–¥ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"""
    
    # –®–ê–ì 1: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    if not validate_input(theme, difficulty, count):
        return error_response()
    
    # –®–ê–ì 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
    history = get_history(theme, limit=50)
    
    # –®–ê–ì 3: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
    prompt = build_prompt(theme, difficulty, count, round_num, history)
    
    # –®–ê–ì 4: –ó–∞–ø—Ä–æ—Å –∫ OpenAI
    response = await openai_request(prompt)
    
    # –®–ê–ì 5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
    questions_data = parse_response(response)
    
    # –®–ê–ì 6: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–µ–π
    unique_questions = filter_duplicates(questions_data, history)
    
    # –®–ê–ì 7: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    if len(unique_questions) < count:
        additional = generate_additional(theme, difficulty, 
                                       count - len(unique_questions))
        unique_questions.extend(additional)
    
    # –®–ê–ì 8: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ Question
    question_objects = create_question_objects(unique_questions)
    
    # –®–ê–ì 9: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
    save_to_history(theme, unique_questions)
    
    # –®–ê–ì 10: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    return question_objects
```

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-07-10  
**–í–µ—Ä—Å–∏—è:** Quiz Bot 2.0 Detailed Steps  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞